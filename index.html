<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… â€” Ø¨Ø« Ù…Ø¨Ø§Ø´Ø± (ÙØ§Ø¦Ù‚ Ø§Ù„Ø¨Ø³Ø§Ø·Ø©)</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@500;700;800&display=swap" rel="stylesheet">
<style>
  :root{--bg:#0f0719;--card:#1a1030;--line:#2c1f4e;--ink:#fff;--muted:#b9b1d4;--accent:#ffd34d}
  *{box-sizing:border-box} html,body{margin:0;background:#0f0719;color:var(--ink);font-family:'Tajawal',sans-serif}
  .wrap{max-width:820px;margin:22px auto;padding:0 14px}
  .card{background:linear-gradient(180deg,#1e1338 0%,#140d26 100%);border:1px solid var(--line);border-radius:16px;box-shadow:0 20px 40px rgba(0,0,0,.45);padding:18px;margin-bottom:14px}
  h1{margin:0 0 8px;font-weight:800}
  label{display:block;margin:10px 0 6px;font-weight:700}
  input,textarea{width:100%;background:#150e29;border:1px solid var(--line);color:var(--ink);padding:12px;border-radius:12px;font-size:16px}
  textarea{min-height:90px;resize:vertical}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .btn{background:var(--accent);border:0;border-radius:12px;padding:12px 16px;font-weight:800;cursor:pointer;margin-top:12px}
  .badge{display:inline-block;background:#2f1b5a;border:1px solid #3a236d;padding:.35rem .7rem;border-radius:999px;color:#cfc6ea;font-size:13px}
  pre{background:#120b22;border:1px solid var(--line);border-radius:12px;padding:12px;overflow:auto}
  .ok{color:#8df58a} .err{color:#ff7c7c}
  small{color:var(--muted)}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… â€” Ø¨Ø¯ÙˆÙ† ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</h1>
    <div class="badge" id="status">Ø¬Ø§Ù‡Ø² â€” Ø¶Ø¹ Ø§Ù„ØªÙˆÙƒÙ† ÙÙŠ Ø§Ù„Ø±Ø§Ø¨Ø·: <code>#gh=TOKEN</code></div>
    <small>Ù…Ø«Ø§Ù„: <code>https://beamingkhaled.github.io/admin.html#gh=YOUR_TOKEN</code></small>
  </div>

  <div class="card">
    <label>Ø§Ù„Ø³Ø¤Ø§Ù„</label>
    <textarea id="q" placeholder="Ø£Ù… Ù…Ø¹ Ø§Ø¨Ù†Ù‡Ø§ Ø§Ù„Ù…Ø±Ø§Ù‡Ù‚ ÙÙŠ Ø§Ù„Ø£ÙÙ†ÙŠÙˆØ²â€¦ Ù…Ø§Ø°Ø§ ØªÙØ¹Ù„ØŸ"></textarea>

    <div class="row">
      <div>
        <label>Ø§Ù„Ø®ÙŠØ§Ø± 1</label>
        <input id="a1" placeholder="â˜•ï¸ Ø¥Ù„Ù‰ Ù…Ù‚Ù‡Ù‰ Ù‚Ø±ÙŠØ¨">
        <label><small>Ù…Ù„Ø§Ø­Ø¸Ø© ØªØ­Øª Ø§Ù„Ø®ÙŠØ§Ø± 1 (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</small></label>
        <input id="a1n" placeholder="Ù‡Ø¯ÙŠØ© 1 ØªØ¹Ø²Ø² Ø§Ù„Ø§Ø­ØªÙ…Ø§Ù„">
      </div>
      <div>
        <label>Ø§Ù„Ø®ÙŠØ§Ø± 2</label>
        <input id="a2" placeholder="ğŸ›ï¸ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù…Ø± Ø§Ù„Ø®Ù„ÙÙŠ">
        <label><small>Ù…Ù„Ø§Ø­Ø¸Ø© ØªØ­Øª Ø§Ù„Ø®ÙŠØ§Ø± 2 (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</small></label>
        <input id="a2n" placeholder="Ø§ÙƒØªØ¨ 2 ÙÙŠ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª">
      </div>
    </div>

    <label style="margin-top:8px">Ø³Ø·Ø± Ù…Ø¹Ù„ÙˆÙ…Ø§Øª/ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø£Ø³ÙÙ„ Ø§Ù„Ø´Ø§Ø´Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
    <input id="meta" placeholder="ØµÙˆÙ‘ØªÙˆØ§ 1 Ø£Ùˆ 2 â€” Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§ ØªØºÙŠÙ‘Ø± Ø§Ù„Ù‚ØµØ© Ù„Ø­Ø¸ÙŠÙ‹Ø§">

    <button class="btn" id="saveBtn">ğŸ’¾ Ø§Ø­ÙØ¸ Ø§Ù„Ø¢Ù†</button>

    <div style="margin-top:10px">
      <small>Ø³ÙŠÙØ­ÙØ¸ Ø¥Ù„Ù‰: <code>beamingkhaled/beamingkhaled.github.io/live.json</code> (ÙØ±Ø¹ main)</small>
    </div>

    <div style="margin-top:10px">
      <pre id="preview">{}</pre>
    </div>
  </div>
</div>

<script>
  // ===== Hard-coded repo settings (no UI, no confusion) =====
  const OWNER  = "beamingkhaled";
  const REPO   = "beamingkhaled.github.io";
  const PATH   = "live.json";
  const BRANCH = "main";
  // ==========================================================

  const $ = s => document.querySelector(s);
  const statusEl = $('#status'), q=$('#q'), a1=$('#a1'), a1n=$('#a1n'), a2=$('#a2'), a2n=$('#a2n'), meta=$('#meta'), preview=$('#preview');

  function tokenFromHash(){
    const h = new URLSearchParams(location.hash.slice(1));
    return h.get('gh') || h.get('token') || "";
  }
  function setStatus(t, cls){ statusEl.textContent = t; statusEl.className = 'badge ' + (cls||''); }
  function buildJSON(){
    const data = {
      question: q.value.trim(),
      option1: { text: a1.value.trim(), note: a1n.value.trim() },
      option2: { text: a2.value.trim(), note: a2n.value.trim() },
      meta: meta.value.trim()
    };
    preview.textContent = JSON.stringify(data, null, 2);
    return data;
  }
  [q,a1,a1n,a2,a2n,meta].forEach(el => el.addEventListener('input', buildJSON)); buildJSON();

  async function getFileMeta(){
    const url = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${encodeURIComponent(PATH)}?ref=${encodeURIComponent(BRANCH)}`;
    const res = await fetch(url, { headers: { 'Accept':'application/vnd.github+json' }});
    if(res.status===404) return {exists:false};
    if(!res.ok) throw new Error('GET contents failed');
    const j = await res.json();
    return {exists:true, sha:j.sha};
  }
  async function saveFile(text, sha, token){
    const url = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${encodeURIComponent(PATH)}`;
    const body = {
      message: "update live.json",
      branch: BRANCH,
      content: btoa(unescape(encodeURIComponent(text))),
      sha: sha || undefined
    };
    const res = await fetch(url, {
      method:'PUT',
      headers:{
        'Accept':'application/vnd.github+json',
        'Authorization': `Bearer ${token}`
      },
      body: JSON.stringify(body)
    });
    if(!res.ok){ throw new Error(await res.text()); }
    return res.json();
  }

  $('#saveBtn').addEventListener('click', async ()=>{
    const token = tokenFromHash();
    if(!token){ alert('Ø£Ø¶Ù ØªÙˆÙƒÙ† GitHub ÙÙŠ Ø§Ù„Ø±Ø§Ø¨Ø· Ø¨Ø¹Ø¯ #gh='); return; }
    try{
      setStatus('ÙŠØ­ÙØ¸ Ø¥Ù„Ù‰ GitHubâ€¦');
      const meta = await getFileMeta().catch(()=>({exists:false}));
      const text = JSON.stringify(buildJSON(), null, 2);
      await saveFile(text, meta.exists?meta.sha:null, token);
      setStatus('ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ…', 'ok');
    }catch(e){
      console.error(e);
      setStatus('ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸ âŒ â€” ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙˆÙƒÙ†/Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª/Ø§Ù„ÙØ±Ø¹', 'err');
    }
  });

  // initial hint
  if(tokenFromHash()) setStatus('Ø§Ù„ØªÙˆÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ø±Ø§Ø¨Ø· âœ…','ok');
</script>
</body>
</html>
