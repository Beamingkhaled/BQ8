<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… â€” Ø¨Ø« Ù…Ø¨Ø§Ø´Ø± (Ø¨Ø¯ÙˆÙ† ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„)</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@500;700;800&display=swap" rel="stylesheet">
<style>
:root{--bg:#0f0719;--card:#1a1030;--line:#2c1f4e;--ink:#fff;--muted:#b9b1d4;--accent:#ffd34d}
*{box-sizing:border-box}html,body{margin:0;background:radial-gradient(1200px 600px at 70% -10%,#2a1750 0%,#0f0719 60%,#090513 100%);color:var(--ink);font-family:'Tajawal',sans-serif}
.wrap{max-width:940px;margin:28px auto;padding:0 14px}
.card{background:linear-gradient(180deg,#1e1338 0%,#140d26 100%);border:1px solid var(--line);border-radius:18px;box-shadow:0 24px 50px rgba(0,0,0,.45);padding:20px;margin-bottom:18px}
h1{margin:0 0 8px;font-weight:800}
.row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
label{display:block;margin:10px 0 6px;font-weight:700}
input,textarea{width:100%;background:#150e29;border:1px solid var(--line);color:var(--ink);padding:12px;border-radius:12px;font-size:16px}
textarea{min-height:90px;resize:vertical}
small{color:var(--muted)}
.btns{display:flex;gap:10px;margin-top:14px;flex-wrap:wrap}
button{background:var(--accent);border:0;cursor:pointer;border-radius:12px;padding:12px 16px;font-weight:800}
.badge{display:inline-flex;align-items:center;gap:8px;background:#2f1b5a;border:1px solid #3a236d;padding:.35rem .7rem;border-radius:999px;color:#cfc6ea;font-size:13px}
code.inline{background:#120b22;border:1px solid var(--line);padding:.2rem .5rem;border-radius:8px}
.ok{color:#8df58a} .err{color:#ff7c7c}
.sep{height:1px;background:#2c1f4e;margin:14px 0}
pre.json{background:#120b22;border:1px solid var(--line);padding:12px;border-radius:12px;overflow:auto;white-space:pre-wrap}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… â€” Ø¨Ø¯ÙˆÙ† ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</h1>
    <div class="badge" id="status">Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙƒÙˆÙŠÙ†â€¦</div>
    <div style="margin-top:10px">
      <small>Ø§ÙØªØ­ Ø§Ù„ØµÙØ­Ø© Ù…Ø¹ ØªÙˆÙƒÙ† Ú¯ÙØªÙ‡Ø§Ø¨ Ù‡ÙƒØ°Ø§:
        <code class="inline">â€¦/admin.html#gh=YOUR_TOKEN</code>
        â€” Ø£Ùˆ Ø£Ù„ØµÙ‚ Ø§Ù„ØªÙˆÙƒÙ† Ø£Ø¯Ù†Ø§Ù‡ Ø¨Ø´ÙƒÙ„ Ù…Ø¤Ù‚Øª (Ù„Ø§ ÙŠØªÙ… Ø­ÙØ¸Ù‡).
      </small>
    </div>
    <div class="row" style="margin-top:10px">
      <div>
        <label>GitHub Token (Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ø¥Ø°Ø§ Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ø±Ø§Ø¨Ø·)</label>
        <input id="tokenInput" type="password" placeholder="ghp_************************" />
      </div>
      <div>
        <label>ÙØ±Ø¹ (Branch)</label>
        <input id="branch" value="main">
      </div>
    </div>
  </div>

  <div class="card">
    <h2 style="margin:0 0 8px">Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø©</h2>
    <label>Ø§Ù„Ø³Ø¤Ø§Ù„</label>
    <textarea id="question" placeholder="Ù…Ø§ Ø§Ù„Ø°ÙŠ Ø³ØªÙØ¹Ù„Ù‡ Ø§Ù„Ø¨Ø·Ù„Ø© Ø§Ù„Ø¢Ù†ØŸ"></textarea>

    <div class="row">
      <div>
        <label>Ø§Ù„Ø®ÙŠØ§Ø± 1</label>
        <input id="opt1" placeholder="ØªØ¯Ø®Ù„ Ù…Ù‚Ù‡Ù‰â€¦" />
        <label><small>Ù…Ù„Ø§Ø­Ø¸Ø© ØªØ­Øª Ø§Ù„Ø®ÙŠØ§Ø± 1 (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</small></label>
        <input id="opt1note" placeholder="Ø§Ø¯Ø¹Ù… Ø¨Ù‡Ø¯ÙŠØ© 1 Ù„Ø±ÙØ¹ Ø§Ù„Ø§Ø­ØªÙ…Ø§Ù„" />
      </div>
      <div>
        <label>Ø§Ù„Ø®ÙŠØ§Ø± 2</label>
        <input id="opt2" placeholder="ØªØ°Ù‡Ø¨ Ù„Ù„Ù…Ù…Ø± Ø§Ù„Ø®Ù„ÙÙŠâ€¦" />
        <label><small>Ù…Ù„Ø§Ø­Ø¸Ø© ØªØ­Øª Ø§Ù„Ø®ÙŠØ§Ø± 2 (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</small></label>
        <input id="opt2note" placeholder="Ø§ÙƒØªØ¨ 2 ÙÙŠ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª" />
      </div>
    </div>

    <label style="margin-top:8px">Ø³Ø·Ø± Ù…Ø¹Ù„ÙˆÙ…Ø§Øª/ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø£Ø³ÙÙ„ Ø§Ù„ÙƒØ§Ø±Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
    <input id="meta" placeholder="Ø§ÙƒØªØ¨ 1 Ø£Ùˆ 2 ÙÙŠ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª / Ø£Ø±Ø³Ù„ Ù‡Ø¯ÙŠØ© Ù„ØªØ£Ø«ÙŠØ± Ø£Ù‚ÙˆÙ‰" />

    <div class="btns">
      <button id="loadBtn">â¬‡ï¸ Ø§Ø¬Ù„Ø¨ Ù…Ù† live.json</button>
      <button id="saveBtn">ğŸ’¾ Ø§Ø­ÙØ¸ Ø¥Ù„Ù‰ live.json</button>
      <button id="pushDemo">âš¡ï¸ Ù…Ø«Ø§Ù„ Ø³Ø±ÙŠØ¹</button>
    </div>

    <div class="sep"></div>
    <div>
      <small>Ø³ÙŠØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù„Ù: <code class="inline" id="filePath"></code></small>
      <pre class="json" id="preview"></pre>
    </div>
  </div>

  <div class="card">
    <h3 style="margin:0 0 6px">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹</h3>
    <div class="row">
      <div>
        <label>OWNER</label>
        <input id="owner" value="beamingkhaled">
      </div>
      <div>
        <label>REPO</label>
        <input id="repo" value="beamingkhaled.github.io">
      </div>
    </div>
    <div class="row">
      <div>
        <label>PATH</label>
        <input id="path" value="live.json">
      </div>
      <div>
        <label>Ø±Ø³Ø§Ù„Ø© Ø§Ù„ÙƒÙˆÙ…ÙØª</label>
        <input id="commitMsg" value="update live.json from admin.html">
      </div>
    </div>
  </div>

  <div class="card">
    <h3 style="margin:0 0 6px">ØµÙŠØºØ© Ø§Ù„Ù…Ù„Ù (ØªÙ‚Ø±Ø£Ù‡Ø§ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©)</h3>
    <pre class="json">{
  "question": "Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„ Ù‡Ù†Ø§",
  "option1": { "text": "Ø§Ù„Ø®ÙŠØ§Ø± 1", "note": "" },
  "option2": { "text": "Ø§Ù„Ø®ÙŠØ§Ø± 2", "note": "" },
  "meta": "Ø³Ø·Ø± ØªØ¹Ù„ÙŠÙ…ÙŠ Ø§Ø®ØªÙŠØ§Ø±ÙŠ"
}</pre>
    <small>Ø¯Ø¹ Ø§Ù„Ø´Ø§Ø´Ø© (front) ØªØ¬Ù„Ø¨ <code class="inline">live.json</code> ÙƒÙ„ 2 Ø«Ø§Ù†ÙŠØ© ÙˆØªØ­Ø¯Ù‘Ø« Ø§Ù„Ø¹Ù†Ø§ØµØ±.</small>
  </div>
</div>

<script>
// ====== CONFIG (edit defaults if ØªØ±ÙŠØ¯) ======
const DEFAULTS = {
  OWNER: "beamingkhaled",
  REPO:  "beamingkhaled.github.io",
  PATH:  "live.json",
  BRANCH:"main"
};
// ============================================

const qs = s => document.querySelector(s);
const statusEl = qs('#status');
const ownerEl  = qs('#owner');
const repoEl   = qs('#repo');
const pathEl   = qs('#path');
const branchEl = qs('#branch');
const commitEl = qs('#commitMsg');
const tokenInput = qs('#tokenInput');
const previewEl = qs('#preview');
const filePathEl = qs('#filePath');

ownerEl.value  = DEFAULTS.OWNER;
repoEl.value   = DEFAULTS.REPO;
pathEl.value   = DEFAULTS.PATH;
branchEl.value = DEFAULTS.BRANCH;

filePathEl.textContent = `${ownerEl.value}/${repoEl.value}/${pathEl.value}`;

// read token from URL hash (#gh=TOKEN)
function tokenFromHash(){
  const h = new URLSearchParams(location.hash.slice(1));
  return h.get('gh') || h.get('token') || "";
}
function getToken(){
  return tokenFromHash() || tokenInput.value.trim();
}
function setStatus(msg, cls){
  statusEl.textContent = msg;
  statusEl.className = 'badge ' + (cls||'');
}

function composeJSON(){
  const data = {
    question: qs('#question').value.trim(),
    option1: { text: qs('#opt1').value.trim(), note: qs('#opt1note').value.trim() },
    option2: { text: qs('#opt2').value.trim(), note: qs('#opt2note').value.trim() },
    meta: qs('#meta').value.trim()
  };
  previewEl.textContent = JSON.stringify(data, null, 2);
  return data;
}
['question','opt1','opt1note','opt2','opt2note','meta'].forEach(id=>{
  qs('#'+id).addEventListener('input', composeJSON);
});
composeJSON();

async function ghGetContents(owner, repo, path, ref){
  const url = `https://api.github.com/repos/${owner}/${repo}/contents/${encodeURIComponent(path)}?ref=${encodeURIComponent(ref)}`;
  const res = await fetch(url, { headers: { 'Accept': 'application/vnd.github+json' }});
  if(res.status === 404) return { exists:false };
  if(!res.ok) throw new Error('GET contents failed');
  const json = await res.json();
  const content = atob((json.content||"").replace(/\n/g,''));
  return { exists:true, sha: json.sha, text: content };
}

async function ghPutContents(owner, repo, path, branch, message, text, sha, token){
  const url = `https://api.github.com/repos/${owner}/${repo}/contents/${encodeURIComponent(path)}`;
  const body = {
    message,
    branch,
    content: btoa(unescape(encodeURIComponent(text))),
    sha: sha || undefined
  };
  const res = await fetch(url, {
    method:'PUT',
    headers:{
      'Accept':'application/vnd.github+json',
      'Authorization': `Bearer ${token}`
    },
    body: JSON.stringify(body)
  });
  if(!res.ok){
    const t = await res.text();
    throw new Error(`PUT failed: ${res.status} ${t}`);
  }
  return res.json();
}

// Load from live.json
qs('#loadBtn').addEventListener('click', async ()=>{
  try{
    setStatus('Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù„Ù Ù…Ù† GitHubâ€¦');
    const {exists, text} = await ghGetContents(ownerEl.value, repoEl.value, pathEl.value, branchEl.value);
    if(!exists){ setStatus('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù„Ù Ø¨Ø¹Ø¯ â€” Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ Ø¹Ù†Ø¯ Ø§Ù„Ø­ÙØ¸', ''); previewEl.textContent='(ÙØ§Ø±Øº)'; return; }
    const data = JSON.parse(text);
    qs('#question').value = data.question || '';
    qs('#opt1').value = data.option1?.text || '';
    qs('#opt1note').value = data.option1?.note || '';
    qs('#opt2').value = data.option2?.text || '';
    qs('#opt2note').value = data.option2?.note || '';
    qs('#meta').value = data.meta || '';
    composeJSON();
    setStatus('ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„ âœ…','ok');
  }catch(e){
    setStatus('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„','err'); console.error(e);
  }
});

// Save to live.json (create or update)
qs('#saveBtn').addEventListener('click', async ()=>{
  const token = getToken();
  if(!token){ alert('Ø£Ø¯Ø®Ù„ ØªÙˆÙƒÙ† GitHub Ø£Ùˆ Ø£Ø¶ÙÙ‡ ÙÙŠ Ø§Ù„Ø±Ø§Ø¨Ø· Ø¨Ø¹Ø¯ #gh='); return; }
  const owner = ownerEl.value.trim(), repo = repoEl.value.trim(), path = pathEl.value.trim();
  filePathEl.textContent = `${owner}/${repo}/${path}`;
  const branch = branchEl.value.trim() || 'main';
  const message = commitEl.value.trim() || 'update live.json';
  const text = JSON.stringify(composeJSON(), null, 2);

  try{
    setStatus('ÙŠØ­ÙØ¸ Ø¥Ù„Ù‰ GitHubâ€¦');
    let sha = null;
    try{
      const meta = await ghGetContents(owner, repo, path, branch);
      sha = meta.exists ? meta.sha : null;
    }catch(_){ sha = null; }
    await ghPutContents(owner, repo, path, branch, message, text, sha, token);
    setStatus('ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ…','ok');
  }catch(e){
    console.error(e);
    setStatus('ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸ âŒ â€” ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª/Ø§Ù„ÙØ±Ø¹/Ø§Ù„Ù…Ø³Ø§Ø±/Ø§Ù„ØªÙˆÙƒÙ†','err');
  }
});

// Quick demo content
qs('#pushDemo').addEventListener('click', ()=>{
  qs('#question').value = 'Ø£Ù… Ù…ØµØ·Ø­Ø¨Ø© Ø§Ø¨Ù†Ù‡Ø§ Ø§Ù„Ù…Ø±Ø§Ù‡Ù‚ ÙÙŠ Ø§Ù„Ø£ÙÙ†ÙŠÙˆØ² â€” Ø¥Ù„Ù‰ Ø£ÙŠÙ† ÙŠØªØ¬Ù‡Ø§Ù†ØŸ';
  qs('#opt1').value = 'â˜•ï¸ Ø¥Ù„Ù‰ Ù…Ù‚Ù‡Ù‰ Ù…Ø²Ø¯Ø­Ù… Ù‚Ø±ÙŠØ¨';
  qs('#opt1note').value = 'Ù‡Ø¯ÙŠØ© 1 ØªØ¹Ø²Ø² Ù‡Ø°Ø§ Ø§Ù„Ø®ÙŠØ§Ø±';
  qs('#opt2').value = 'ğŸ›ï¸ Ø¥Ù„Ù‰ Ù…Ù…Ø± Ø§Ù„Ù…Ø­Ù„Ø§Øª Ø§Ù„Ø®Ù„ÙÙŠ';
  qs('#opt2note').value = 'Ø§ÙƒØªØ¨ 2 ÙÙŠ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª';
  qs('#meta').value = 'ØµÙˆÙ‘ØªÙˆØ§ Ø§Ù„Ø¢Ù†: 1 Ø£Ùˆ 2 â€” Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§ ØªØºÙŠÙ‘Ø± Ø§Ù„Ù‚ØµØ© Ù„Ø­Ø¸ÙŠÙ‹Ø§';
  composeJSON();
});

// Initial status
(function init(){
  const has = tokenFromHash();
  if(has){ setStatus('ØªÙˆÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ø±Ø§Ø¨Ø· âœ…','ok'); }
  else    { setStatus('Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙˆÙƒÙ† â€” ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ù„ØµÙ‚ Ù…Ø¤Ù‚ØªÙ‹Ø§ Ø£Ø¯Ù†Ø§Ù‡',''); }
})();
</script>
</body>
</html>
