<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… â€” ØªØºÙŠÙŠØ± Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª ÙÙˆØ±Ø§Ù‹</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@500;700;800&display=swap" rel="stylesheet">
<style>
  :root{--bg:#0f0719;--card:#1a1030;--line:#2c1f4e;--ink:#fff;--muted:#b9b1d4;--accent:#ffd34d}
  *{box-sizing:border-box} html,body{margin:0;background:#0f0719;color:var(--ink);font-family:'Tajawal',sans-serif}
  .wrap{max-width:900px;margin:22px auto;padding:0 14px}
  .card{background:linear-gradient(180deg,#1e1338 0%,#140d26 100%);border:1px solid var(--line);border-radius:16px;box-shadow:0 20px 40px rgba(0,0,0,.45);padding:18px;margin-bottom:14px}
  h1,h2{margin:0 0 8px;font-weight:800}
  label{display:block;margin:10px 0 6px;font-weight:700}
  input,textarea{width:100%;background:#150e29;border:1px solid var(--line);color:var(--ink);padding:12px;border-radius:12px;font-size:16px}
  textarea{min-height:80px;resize:vertical}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .btn{background:var(--accent);border:0;border-radius:12px;padding:12px 16px;font-weight:800;cursor:pointer}
  .btn.secondary{background:#2f1b5a;border:1px solid #3a236d;color:#cfc6ea}
  .bar{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
  .badge{display:inline-flex;align-items:center;gap:8px;background:#2f1b5a;border:1px solid #3a236d;padding:.35rem .7rem;border-radius:999px;color:#cfc6ea;font-size:13px}
  small{color:var(--muted)}
  .live{color:#8df58a}.err{color:#ff7c7c}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… â€” ØªØ­ÙƒÙ… Ù…Ø¨Ø§Ø´Ø± Ø¨Ù„Ø§ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</h1>
    <div class="bar">
      <input id="frontUrl" placeholder="Ø¶Ø¹ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ© (Ù…Ø«Ø§Ù„: https://your-front-domain/index.html)">
      <button class="btn secondary" id="openFront">Ø§ÙØªØ­/Ø§ØªØµÙ„ Ø¨Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©</button>
      <span class="badge" id="status">ØºÙŠØ± Ù…ØªØµÙ„</span>
    </div>
    <small>Ù…Ù„Ø§Ø­Ø¸Ø©: ÙŠØ¬Ø¨ ÙØªØ­ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ© ÙÙŠ **Ù†ÙØ³ Ø§Ù„Ù…ØªØµÙØ­** Ù„ÙŠØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙÙˆØ±ÙŠ.</small>
  </div>

  <div class="card">
    <h2>Ø§Ù„Ù…Ø­ØªÙˆÙ‰</h2>
    <label>Ø§Ù„Ø³Ø¤Ø§Ù„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
    <textarea id="q" placeholder="Ù…Ø«Ø§Ù„: Ø£Ù… Ù…Ø¹ Ø§Ø¨Ù†Ù‡Ø§ Ø§Ù„Ù…Ø±Ø§Ù‡Ù‚ ÙÙŠ Ø§Ù„Ø£ÙÙ†ÙŠÙˆØ² â€” Ù…Ø§Ø°Ø§ ØªÙØ¹Ù„ Ø§Ù„Ø¢Ù†ØŸ"></textarea>

    <div class="row">
      <div>
        <label>Ø§Ù„Ø®ÙŠØ§Ø± 1</label>
        <textarea id="a1" placeholder="â˜•ï¸ ØªØ¯Ø®Ù„ Ù…Ù‚Ù‡Ù‰ Ù…Ø²Ø¯Ø­Ù…"></textarea>
      </div>
      <div>
        <label>Ø§Ù„Ø®ÙŠØ§Ø± 2</label>
        <textarea id="a2" placeholder="ğŸ›ï¸ ØªØ°Ù‡Ø¨ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù…Ø± Ø§Ù„Ø®Ù„ÙÙŠ"></textarea>
      </div>
    </div>

    <label>Ø³Ø·Ø± Ø³ÙÙ„ÙŠ/ØªØ¹Ù„ÙŠÙ…Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
    <input id="meta" placeholder="Ø§ÙƒØªØ¨ 1 Ø£Ùˆ 2 ÙÙŠ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª â€” Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§ ØªØºÙŠÙ‘Ø± Ø§Ù„Ù‚ØµØ©">

    <div class="bar">
      <button class="btn" id="push">ØºÙŠÙ‘Ø± Ø§Ù„Ø¢Ù†</button>
      <button class="btn secondary" id="demo">Ù…Ø«Ø§Ù„ ØªØ¹Ø¨Ø¦Ø©</button>
    </div>
  </div>
</div>

<script>
  // ==============================================
  // Ø£Ø¨Ø³Ø· Ø§ØªØµØ§Ù„ Ù…Ù…ÙƒÙ†: window.postMessage Ø¨ÙŠÙ† Ù†Ø§ÙØ°ØªÙŠÙ†
  // 1) Ø§Ø¶ØºØ· "Ø§ÙØªØ­/Ø§ØªØµÙ„" Ù„ÙØªØ­ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯ (Front)
  // 2) Ø§ÙƒØªØ¨ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª ÙˆØ§Ø¶ØºØ· "ØºÙŠÙ‘Ø± Ø§Ù„Ø¢Ù†" Ù„Ø¥Ø±Ø³Ø§Ù„Ù‡Ø§ ÙÙˆØ±Ø§Ù‹
  // ==============================================

  const frontUrlInput = document.getElementById('frontUrl');
  const openBtn = document.getElementById('openFront');
  const pushBtn = document.getElementById('push');
  const demoBtn = document.getElementById('demo');
  const statusEl = document.getElementById('status');

  const qEl = document.getElementById('q');
  const a1El = document.getElementById('a1');
  const a2El = document.getElementById('a2');
  const metaEl = document.getElementById('meta');

  let frontWin = null;
  let frontOrigin = '*'; // Ù„Ùˆ Ø£Ø±Ø¯Øª Ø§Ù„ØªØ´Ø¯ÙŠØ¯ØŒ Ø¶Ø¹ Ø£ØµÙ„ (Origin) Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ© Ù‡Ù†Ø§

  // Ø§ÙØªØ­/Ø§ØªØµÙ„ Ø¨Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©
  openBtn.addEventListener('click', ()=>{
    const url = frontUrlInput.value.trim();
    if(!url){ alert('Ø¶Ø¹ Ø±Ø§Ø¨Ø· Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹'); return; }
    try{
      // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù†Ø§ÙØ°Ø© Ù…ÙØªÙˆØ­Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹ØŒ Ø­Ø§ÙˆÙ„ Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„ÙŠÙ‡Ø§
      if(frontWin && !frontWin.closed){
        frontWin.focus();
      }else{
        frontWin = window.open(url, 'AvenuesFront');
      }
      statusEl.textContent = 'ØªÙ… Ø§Ù„ÙØªØ­ â€” ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ù…Ù† Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©â€¦';
    }catch(e){
      console.error(e);
      statusEl.textContent = 'ØªØ¹Ø°Ø± Ø§Ù„ÙØªØ­'; statusEl.className = 'badge err';
    }
  });

  // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«
  pushBtn.addEventListener('click', ()=>{
    if(!frontWin || frontWin.closed){
      statusEl.textContent = 'ØºÙŠØ± Ù…ØªØµÙ„ â€” Ø§ÙØªØ­ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹';
      statusEl.className = 'badge err';
      alert('Ø§ÙØªØ­/Ø§ØªØµÙ„ Ø¨Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹');
      return;
    }
    const payload = {
      type: 'UPDATE_CHOICES',
      question: qEl.value.trim(),
      option1: a1El.value.trim(),
      option2: a2El.value.trim(),
      meta: metaEl.value.trim(),
      ts: Date.now()
    };
    try{
      frontWin.postMessage(payload, frontOrigin);
      statusEl.textContent = 'Ø£ÙØ±Ø³Ù„Øª Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª âœ”ï¸';
      statusEl.className = 'badge live';
    }catch(e){
      console.error(e);
      statusEl.textContent = 'ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„';
      statusEl.className = 'badge err';
    }
  });

  // Ù…Ø«Ø§Ù„ ØªØ¹Ø¨Ø¦Ø© Ø³Ø±ÙŠØ¹
  demoBtn.addEventListener('click', ()=>{
    qEl.value = 'Ø£Ù…Ù‘ Ù…Ø¹ Ø§Ø¨Ù†Ù‡Ø§ Ø§Ù„Ù…Ø±Ø§Ù‡Ù‚ ÙÙŠ Ø§Ù„Ø£ÙÙ†ÙŠÙˆØ² â€” Ù…Ø§Ø°Ø§ ØªÙØ¹Ù„ Ø§Ù„Ø¢Ù†ØŸ';
    a1El.value = 'â˜•ï¸ ØªØ¯Ø®Ù„ Ù…Ù‚Ù‡Ù‰ Ù…Ø²Ø¯Ø­Ù…';
    a2El.value = 'ğŸ›ï¸ ØªØ°Ù‡Ø¨ Ù„Ù„Ù…Ù…Ø± Ø§Ù„Ø®Ù„ÙÙŠ';
    metaEl.value = 'Ø§ÙƒØªØ¨ 1 Ø£Ùˆ 2 ÙÙŠ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª â€” Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§ ØªØºÙŠÙ‘Ø± Ø§Ù„Ù‚ØµØ©';
  });

  // Ø§Ø³ØªÙ‚Ø¨Ù„ "ØªØ­ÙŠØ©" Ù…Ù† Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ© Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„
  window.addEventListener('message', (ev)=>{
    // ÙŠÙ…ÙƒÙ†Ùƒ Ù‡Ù†Ø§ ÙØ­Øµ ev.origin Ù„Ùˆ Ø£Ø±Ø¯Øª
    if(ev && ev.data && ev.data.type === 'FRONT_READY'){
      statusEl.textContent = 'Ù…ØªØµÙ„ Ø¨Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ© âœ…';
      statusEl.className = 'badge live';
    }
  });
</script>
</body>
</html>
